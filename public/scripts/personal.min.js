"use strict";function search(t){$.ajax({method:"GET",url:"/api/history/search?type="+$("#search-type").val()+"&search_str="+$(".search-group input").val()+"&sdate="+$(".start-date-group .input-group input").val()+"&edate="+$(".end-date-group .input-group input").val()+"&page="+t+"&limit=10",dataType:"json",timeout:"10000",success:function(t){if(t.ok){var e="";t.list.length>0?($("#paginator").show(),$("#no-data").hide(),t.list.forEach(function(t){e+="<tr><td>"+t.old_filename+"</td><td>"+t.filesize+"</td><td>"+t.time+'</td><td><a href="'+t.remote_url+'" target="_blank">'+t.remote_url+"</a></td></tr>"}),$("#history .table tbody").html(e),$("#paginator").jqPaginator("option",{totalPages:Math.ceil(t.total/10)||1,totalCounts:t.total||1,currentPage:1,onPageChange:function(t,e){search(t)}})):($("#no-data").show(),$("#paginator").hide())}else showAlert("error",t.msg)},error:function(t){showAlert("error","搜索失败")}})}function getList(t,e){e||(e=10),t||(t=1),e=parseInt(e),t=parseInt(t),t<1&&(t=1),$.ajax({method:"GET",url:"/api/history/list?page="+t+"&limit="+e,dataType:"json",timeout:"10000",success:function(e){if(e.ok){var a="";e.list.length>0?($("#paginator").show(),$("#no-data").hide(),e.list.forEach(function(t){a+="<tr><td>"+t.old_filename+"</td><td>"+t.filesize+"</td><td>"+t.time+"</td><td>"+t.remote_url+"</td></tr>"}),$("#history .table tbody").html(a),$("#paginator").jqPaginator("option",{totalPages:Math.ceil(e.total/10)||1,totalCounts:e.total||1,currentPage:t}),currentPage=t):($("#no-data").show(),$("#paginator").hide())}else showAlert("error",e.msg)},error:function(t){showAlert("error","获取历史记录失败")}})}!function(t){t.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今天",suffix:[],meridiem:["上午","下午"]}}(jQuery);var currentPage=1;$(document).ready(function(){var t=$(".content section");t.each(function(){$(this).offset().top>$(window).scrollTop()+.75*$(window).height()&&$(this).addClass("is-hidden")}),$(window).on("scroll",function(){t.each(function(){$(this).offset().top<=$(window).scrollTop()+.75*$(window).height()&&$(this).hasClass("is-hidden")&&$(this).removeClass("is-hidden").addClass("bounce-in")})}),$(".content article > h3").on("click",function(){$(this).hasClass("hide-more")?($(this).removeClass("hide-more"),$(this).parent().find("section").fadeIn()):($(this).addClass("hide-more"),$(this).parent().find("section").fadeOut())}),$(".form_date").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0,format:"yyyy-mm-dd"}),$("#search-type").on("change",function(){"0"==$(this).val()?($(".start-date-group, .end-date-group").css("display","none"),$(".search-group").css("display","inline-block")):"1"==$(this).val()&&($(".start-date-group, .end-date-group").css("display","inline-block"),$(".search-group").css("display","none"))}),$("#paginator").jqPaginator({totalPages:1,totalCounts:1,pageSize:10,visiblePages:10,currentPage:currentPage,first:"",prev:'<li class="prev"><a href="javascript:void(0);">前一页</a></li>',next:'<li class="next"><a href="javascript:void(0);">后一页</a></li>',last:"",page:'<li class="page"><a href="javascript:void(0);">{{page}}</a></li>',onPageChange:function(t,e){getList(t,10)}}),$(".button-group > a").on("click",function(){search(1)}),"#history"==window.location.hash&&$("#history-tab").trigger("click"),$("#save").click(function(){var t=[];$("#setting .options .option > input").each(function(){"text"===$(this).attr("type")?t.push({stname:$(this).attr("name"),value:$(this).val()}):t.push({stname:$(this).attr("name"),value:$(this).prop("checked")})}),$.ajax({method:"POST",url:"/api/setting",data:{setting:t},dataType:"json",timeout:"10000",success:function(t){t.ok?showAlert("success","保存设置成功"):showAlert("error",t.msg)},error:function(t){showAlert("error","更新设置失败")}})})});
